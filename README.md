# DangleData v2.0 - Modular Architecture

NHL Player Prop Analytics & Betting Line Tracker with protected backend APIs.

## üèóÔ∏è Architecture

```
dangledata/
‚îú‚îÄ‚îÄ index.html              # Minimal HTML shell (4.5KB)
‚îú‚îÄ‚îÄ favicon.png
‚îú‚îÄ‚îÄ styles/
‚îÇ   ‚îî‚îÄ‚îÄ main.css            # All styles extracted (15KB)
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îú‚îÄ‚îÄ config.js           # Configuration
‚îÇ   ‚îú‚îÄ‚îÄ api-client.js       # Backend API client
‚îÇ   ‚îú‚îÄ‚îÄ state.js            # Global state management
‚îÇ   ‚îú‚îÄ‚îÄ utils.js            # Utility functions
‚îÇ   ‚îú‚îÄ‚îÄ constants.js        # Team mappings & constants
‚îÇ   ‚îú‚îÄ‚îÄ main.js             # Entry point & initialization
‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ       ‚îú‚îÄ‚îÄ player-card.js  # Player/goalie card rendering
‚îÇ       ‚îú‚îÄ‚îÄ display.js      # Grid display logic
‚îÇ       ‚îú‚îÄ‚îÄ watchlist.js    # Watchlist UI
‚îÇ       ‚îú‚îÄ‚îÄ parlay.js       # Parlay calculator
‚îÇ       ‚îú‚îÄ‚îÄ modal.js        # Game log modals
‚îÇ       ‚îú‚îÄ‚îÄ filters.js      # Search & filter logic
‚îÇ       ‚îî‚îÄ‚îÄ theme.js        # Dark mode toggle
‚îú‚îÄ‚îÄ api/                    # Backend (Vercel Serverless)
‚îÇ   ‚îú‚îÄ‚îÄ calculate-rankings.js      # üîí Proprietary player rankings
‚îÇ   ‚îú‚îÄ‚îÄ calculate-goalie-rankings.js # üîí Proprietary goalie rankings
‚îÇ   ‚îú‚îÄ‚îÄ calculate-hit-rates.js     # üîí Hit rate algorithms
‚îÇ   ‚îú‚îÄ‚îÄ get-data.js                # Serve cached data
‚îÇ   ‚îú‚îÄ‚îÄ nhl.js                     # NHL API proxy
‚îÇ   ‚îî‚îÄ‚îÄ update-data.js             # Cron job for data refresh
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ vercel.json
```

## üîí Security Benefits

1. **Protected Algorithms**: All proprietary calculations run server-side
   - Composite scoring formulas hidden from client
   - Hit rate algorithms protected
   - Ranking weights not exposed

2. **Modular Code**: Easier to audit and maintain
   - Each component has a single responsibility
   - Clear separation of concerns
   - No inline JavaScript in HTML

3. **ES Modules**: Modern import/export system
   - Tree-shaking capable for production builds
   - Clear dependency graph
   - Better browser caching

## ‚ö° Performance Benefits

1. **Smaller Initial Load**: HTML shell is only ~4.5KB
2. **Parallel Loading**: CSS and JS modules load in parallel
3. **Browser Caching**: Individual files can be cached separately
4. **Lazy Loading Ready**: Components can be dynamically imported

## üöÄ Deployment

### Vercel (Recommended)
```bash
# Install Vercel CLI
npm i -g vercel

# Deploy
vercel
```

### Environment Variables (Vercel Dashboard)
- `CRON_SECRET` - Random string for cron authentication
- `ODDS_API_KEY` - Your The Odds API key
- `BLOB_READ_WRITE_TOKEN` - Auto-generated by Vercel Blob

## üìÅ Component Overview

### State Management (`js/state.js`)
Central state store with subscription system:
```javascript
import state from './state.js';

// Subscribe to changes
state.subscribe('watchlist', (newWatchlist) => {
  console.log('Watchlist updated:', newWatchlist);
});

// Update state
state.addToWatchlist({ playerId, playerName, ... });
```

### API Client (`js/api-client.js`)
Handles all backend communication:
```javascript
import api from './api-client.js';

// Fetch cached data
const data = await api.getCachedData();

// Calculate rankings (server-side)
const rankings = await api.calculatePlayerRankings(players, gameLogs, ...);
```

### Global API (`window.proptrack`)
Functions exposed for HTML onclick handlers:
- `selectStat(stat)` - Change stat type
- `filterPlayers()` - Apply filters
- `addToWatchlist(...)` - Add to watchlist
- `showGameLog(playerId)` - Open modal
- `toggleDarkMode()` - Theme toggle

## üîÑ Migration from v1.0

The monolithic `index.html` (~3400 lines) has been split into:
- 1 HTML file (4.5KB)
- 1 CSS file (15KB)
- 7 JS modules (~40KB total)
- 6 API files (unchanged)

All functionality preserved, same UI, better architecture.

## üõ†Ô∏è Development

```bash
# Install dependencies
npm install

# Run locally
npm run dev

# Open http://localhost:3000
```

## üìù License

Proprietary - All rights reserved
